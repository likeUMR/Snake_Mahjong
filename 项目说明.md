# 项目说明

1. 这是一个贪吃蛇+麻将的项目
2. 麻将作为贪吃蛇的“食物”和身体
3. 4人同时开始对局（1真人+3AI），任意一人胡牌则其游戏胜利，其它玩家游戏失败

# 开发阶段1（基础功能）

1. 建立一个config，配置场景大小，场景划分为许多基础格子（长方形格子，跟麻将牌的形状大小相同）
2. 实现“食物”的在场景中的随机生成（均匀采样所有麻将牌，生成时背面向上）
3. 一条贪吃蛇的生成与控制（由一个头部，和身体组成，wasd控制头部移动，配置一个摄像机跟随贪吃蛇头部移动，config可设置跟随速度和纵向视野范围（格，横向根据窗口自动计算））
4. 贪吃蛇可以吃掉“食物”（当头部和食物碰撞时，食物对应的麻将牌瞬间出现在贪吃蛇的尾部，然后食物消失）


# 开发阶段2（自我麻将逻辑）

1. 实现麻将排序算法，按照序牌-字牌的顺序排列，序牌按照万-条-饼排列，组内按照从小到大排列，字牌按照中-发-白-东-南-西-北排列
2. 当拥有的麻将发生变化的时候（例如吃了食物牌），下一次移动前触发排序，下一帧的身体顺序为排序后的顺序
3. 实现身体长度上限，当携带的麻将达到上限时，改变蛇头的颜色，此时不能吃掉食物（上限在config中配置，默认等于基础麻将手牌数量）另外头部需要显示当前长度的数字
4. 实现胡牌检测，当胡牌的时候，暂停游戏并在真人游戏界面显示游戏胜利（只要包含一组可胡牌的牌即为胡牌，在拥有的麻将发生变动时进行胡牌检测）
5. 当碰到场地边缘的时候，从场地另一端出现，而不是重新开始游戏


# 开发阶段3（弃牌逻辑）

1. 在屏幕下方中央，显示自己目前的所有牌（按照顺序排列，不用和基本地图对齐，圆角UI边框，浮于上层，除了牌是半透明的）
2. 可以通过点击UI中的牌，来弃掉该牌（立刻删除这张牌，然后下一次移动前触发排序）
3. 弃牌后的下一次移动前，触发排序


# 开发阶段4（AI生成）

1. 在游戏开始的时候，额外创建3个AI（玩家为1号位，AI分别为2号位，3号位，4号位，按照座次分别为玩家的下家，对家，和上家）
2. AI的移动模式为随机游走（每随机时间间隔，改变一次方向（随机左转或者右转），加入config设置）
3. 对AI也进行胡牌检测，当AI胡牌的时候，暂停游戏并在真人游戏界面显示游戏失败
4. 在AI敌人的蛇头上方附加标识文字（上家文字为绿色，对家为白色，下家为红色，类似称号的显示方法不是在同一格显示）


# 开发阶段5（玩家间的交互）

1. 不同玩家之间可以进行碰撞（当A玩家的蛇头，碰撞到B玩家的身体时，称为A撞了B，当AB玩家的蛇头相撞时，成为AB对撞，当身体接触的时候，不认为发生了碰撞）
2. 对于A撞了B的情况，A陷入眩晕3秒（眩晕期间不能移动，眩晕时长加入config设置）
3. 对于A，B对撞的情况，双方同时陷入眩晕3秒


# 开发阶段6（吃碰杠）

1. 增加吃碰杠检测，可以计算A撞了B时，A是否能使用B身体中的牌形成吃碰杠
2. 修改A撞了B时的效果：
    当A可以吃B中的某张牌，且B为A的上家，则A掠夺B对应的牌（B身体中的这张牌立刻消失，A身体尾端立刻出现这张牌，下一次移动双方触发排序）若有多个可吃的牌，选择第一个
    当A可以碰B中的某张牌，则A掠夺B对应的牌，若有多个可碰的牌，选择第一个
    当A可以杠B中的某张牌，则A掠夺B对应的牌，若有多个可杠的牌，选择第一个
    其中，先判定杠，然后判定碰，之后判定吃，都判定失败后，A陷入眩晕。若有任何一个判定成功，则跳过后续的判定，下一帧双方正常移动
3. 当玩家被其它玩家掠夺麻将牌的时候，应该虚化3s（虚化期间不参与玩家间碰撞（自己不能碰别人，别人不能碰自己，仍然可以吃掉食物），全身显示为半透明，时长加入config中设置）


# 开发阶段7（更智能的敌人AI）

1. AI具有和真人玩家相同大小的视野范围，
2. AI具有自己的状态机，分为游走，觅食，追逐，逃跑四种状态
3. 初始为游走状态，游走状态持续一定次数的移动后检测切换状态（次数加入config进行配置）
    首先，检测视野范围内是否具有自己可以吃碰杠的玩家，若有，则将目标设置为距离自己蛇头最近的一个身体格，进入追逐状态
    如果没有，检测视野范围内是否具有可以吃碰杠自己的玩家，若有，将目标设置为距离自己蛇头最近的一个蛇头，进入逃跑状态
    如果没有，检测视野范围内是否具有“食物”，若有，将目标设置为距离自己蛇头最近的食物，进入觅食状态
4. 目标是物体，不是地图个，目标坐标随目标物体移动而移动
5. 在追逐状态，每次移动时，朝向合法的最速接近目标的方向移动（仍然只能上下左右移动，且不能掉头），一段时间后（config设置），退回游走状态
6. 在逃跑状态，每次移动时，朝向合法的最速远离目标的方向移动（仍然只能上下左右移动，且不能掉头），一段时间后（config设置），退回游走状态
7. 在觅食状态，每次移动时，朝向合法的最速接近目标的方向移动（仍然只能上下左右移动，且不能掉头），吃掉目标后，退回游走状态

# 开发阶段8（铁牌机制）

1. 任意玩家吃碰杠之后，组成的顺子，刻子，杠子应该成为铁牌（对应传统麻将的明牌）
2. 铁牌固定放置在紧跟着蛇头的后面，并且吃碰杠判定时，铁牌不会参与（铁牌不会被掠夺）
3. 铁牌分组进行排序，排序标准为一组的首张牌
4. 铁牌显示为淡灰色，在弃牌ui中也以一组的形式呈现（组内无间隙）放置在ui的最左边，排序逻辑和上面的相同
5. 铁牌正常计算容量，但是杠之后需要增加1的容量上限（符合麻将规则）
6. 暗杠铁牌（当自己通过食物获得了一张牌可以组成“暗杠“的时候，立刻把暗杠生成为一组铁牌，然后容量上限+1 （TODO）

# 开发阶段9（显示优化）

1. 吃，碰，杠的时候，应该在附近生成一个暂时的特效文字（吃！，碰！，杠！）
2. config增加设置，设置删牌ui界面的大小
3. 增加可吃，可碰，可杠的麻将显示（开发阶段7中有类似的逻辑，可以构思一下抽离出来防止重复实现，当真人玩家或者AI玩家的牌库发生变化时，计算所有AI玩家/牌库变化的AI玩家 牌库中可以提供真人玩家吃碰杠的牌，并且改变这些牌边框的颜色
    吃只对上家计算，其它的对所有玩家计算（跟实际碰撞后的效果逻辑相同，作为预提示）
    config中提供设置，分别设置吃碰杠三种情况边框的颜色
4. 在log中显示敌人ai的切换和目标选择信息，方便debug
5. 眩晕的时候，有时候没有显示眩晕的文字，需要debug


# 开发阶段10（AI弃牌逻辑）

1. 设计方法，计算目前弃置哪张牌最优
2. 当AI满牌的时候，自动弃置一张牌
3. 铁牌不能被吃碰杠，也不能弃牌


# 开发阶段11（分数统计）

1. 对于每个玩家增加分数统计（无论真人还是AI）
2. 在config中增加设置项：当吃掉食物，触发吃，碰，杠，暗杠，胡牌的时候，增加分数
3. 在画面上显示当前分数排行榜





# 开发阶段12（更多胡牌方式）

1. 实现更多的胡牌形式，
2. 在胜利时显示胡牌类型